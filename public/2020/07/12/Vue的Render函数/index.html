<!DOCTYPE html>
<html lang="zh-cn">
    <head>
    <meta charset="utf-8">

    

    <!-- 渲染优化 -->
    <meta name="renderer" content="webkit">
    <meta name="force-rendering" content="webkit">
    <meta http-equiv="X-UA-Compatible" content="IE=Edge,chrome=1">
    <meta name="HandheldFriendly" content="True" >
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

    <!--icon-->

    
    
    
    
    


    <!-- meta -->


<title>Vue的Render函数 | SleeoWen-Blog</title>


    <meta name="keywords" content="Vue, js,ts,web,h5">




    <!-- OpenGraph -->
 
    <meta name="description" content="前几天想学学 Vue 中怎么编写可复用的组件，提到要对 Vue 的render函数有所了解。可仔细一想，对于 Vue 的render函数自己只是看了官方的一些介绍，并未深入一点去了解这方面的知识。为了更好的学习后续的知识，又折回来了解 Vue 中的render函数，这一切主要都是为了后续能更好的学习 Vue 的知识。">
<meta property="og:type" content="article">
<meta property="og:title" content="Vue的Render函数">
<meta property="og:url" content="https://sleeowen.github.io/2020/07/12/Vue%E7%9A%84Render%E5%87%BD%E6%95%B0/index.html">
<meta property="og:site_name" content="SleeoWen-Blog">
<meta property="og:description" content="前几天想学学 Vue 中怎么编写可复用的组件，提到要对 Vue 的render函数有所了解。可仔细一想，对于 Vue 的render函数自己只是看了官方的一些介绍，并未深入一点去了解这方面的知识。为了更好的学习后续的知识，又折回来了解 Vue 中的render函数，这一切主要都是为了后续能更好的学习 Vue 的知识。">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="http://upload-images.jianshu.io/upload_images/13429147-32832d6b08b108c4.jpg">
<meta property="og:image" content="http://upload-images.jianshu.io/upload_images/13429147-53f54999b1bc18e9.png">
<meta property="og:image" content="http://upload-images.jianshu.io/upload_images/13429147-4eb2a73597a2a9aa.png">
<meta property="og:image" content="http://upload-images.jianshu.io/upload_images/13429147-4c7f8bdf4b804bd9.png">
<meta property="og:image" content="http://upload-images.jianshu.io/upload_images/13429147-e5ab233db6c73c31.png">
<meta property="og:image" content="http://upload-images.jianshu.io/upload_images/13429147-54ee24bdb630fb55.png">
<meta property="og:image" content="http://upload-images.jianshu.io/upload_images/13429147-b34d3ed28b6eccb6.png">
<meta property="og:image" content="http://upload-images.jianshu.io/upload_images/13429147-3466e87621454e79.png">
<meta property="og:image" content="http://upload-images.jianshu.io/upload_images/13429147-7f193c6cb2e36da0.png">
<meta property="og:image" content="http://upload-images.jianshu.io/upload_images/13429147-eb35f142664bda0c.png">
<meta property="og:image" content="http://upload-images.jianshu.io/upload_images/13429147-cafcbeeddcfda7e4.png">
<meta property="og:image" content="http://upload-images.jianshu.io/upload_images/13429147-bef18523b2d62e16.png">
<meta property="og:image" content="http://upload-images.jianshu.io/upload_images/13429147-1c69ce736a29a3c1.png">
<meta property="og:image" content="http://upload-images.jianshu.io/upload_images/13429147-e0558045f83150dd.png">
<meta property="og:image" content="http://upload-images.jianshu.io/upload_images/13429147-b4d9489c6fd49ab6.gif">
<meta property="og:image" content="http://upload-images.jianshu.io/upload_images/13429147-a59263e3580b34ee.png">
<meta property="article:published_time" content="2020-07-12T12:48:42.000Z">
<meta property="article:modified_time" content="2022-06-22T07:37:25.163Z">
<meta property="article:author" content="文宇函">
<meta property="article:tag" content="Vue">
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:image" content="http://upload-images.jianshu.io/upload_images/13429147-32832d6b08b108c4.jpg">


    
<link rel="stylesheet" href="/css/style/main.css">
 

    
    
        <link rel="stylesheet" id="hl-default-theme" href="/css/highlight/default.css" media="none" onload="this.media='all'">
        
    

    
    

    

     

    <!-- custom head -->

<meta name="generator" content="Hexo 6.2.0"></head>

    <body>
        <div id="app">
            <header class="header">
    <div class="header__left">
        <a href="/" class="button">
            <span class="logo__text">Demo</span>
        </a>
    </div>
    <div class="header__right">
        
            <div class="navbar__menus">
                
                    <a href="/" class="navbar-menu button">首页</a>
                
                    <a href="/tags/" class="navbar-menu button">标签</a>
                
                    <a href="/archives/" class="navbar-menu button">归档</a>
                
                    <a href="/friends/" class="navbar-menu button">友链</a>
                
                    <a href="/page/" class="navbar-menu button">Page</a>
                
            </div>
        
        
        

        
        

        
            <a class="dropdown-icon button" id="btn-dropdown" tabindex="0"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" width='24' height='24' fill="none" stroke="currentColor" stroke-width="0.7" stroke-linecap="round" stroke-linejoin="round"><path fill="currentColor" d="M3.314,4.8h13.372c0.41,0,0.743-0.333,0.743-0.743c0-0.41-0.333-0.743-0.743-0.743H3.314c-0.41,0-0.743,0.333-0.743,0.743C2.571,4.467,2.904,4.8,3.314,4.8z M16.686,15.2H3.314c-0.41,0-0.743,0.333-0.743,0.743s0.333,0.743,0.743,0.743h13.372c0.41,0,0.743-0.333,0.743-0.743S17.096,15.2,16.686,15.2z M16.686,9.257H3.314c-0.41,0-0.743,0.333-0.743,0.743s0.333,0.743,0.743,0.743h13.372c0.41,0,0.743-0.333,0.743-0.743S17.096,9.257,16.686,9.257z"></path></svg></a>
            <div class="dropdown-menus" id="dropdown-menus">
                
                    <a href="/" class="dropdown-menu button">首页</a>
                
                    <a href="/tags/" class="dropdown-menu button">标签</a>
                
                    <a href="/archives/" class="dropdown-menu button">归档</a>
                
                    <a href="/friends/" class="dropdown-menu button">友链</a>
                
                    <a href="/page/" class="dropdown-menu button">Page</a>
                
            </div>
        
    </div>
</header>


            <main class="main">
    

<div class="post-title">
    <h1 class="post-title__text">
        Vue的Render函数
    </h1>
    <div class="post-title__meta">
        <a href="/archives/2020/07/" class="post-meta__date button">2020-07-12</a>
        
 
        
    
    


 

 
    </div>
</div>



<article class="post content-card">
    <div class="post__header"></div>
    <div class="post__content">
        <p>前几天想学学 Vue 中怎么编写可复用的组件，提到要对 Vue 的<code>render</code>函数有所了解。可仔细一想，对于 Vue 的<code>render</code>函数自己只是看了官方的一些介绍，并未深入一点去了解这方面的知识。为了更好的学习后续的知识，又折回来了解 Vue 中的<code>render</code>函数，这一切主要都是为了后续能更好的学习 Vue 的知识。</p>
<span id="more"></span>
<h2 id="回忆-Vue-的一些基本概念"><a href="#回忆-Vue-的一些基本概念" class="headerlink" title="回忆 Vue 的一些基本概念"></a>回忆 Vue 的一些基本概念</h2><p>今天我们学习的目的是了解和学习 Vue 的<code>render</code>函数。如果想要更好的学习 Vue 的<code>render</code>函数相关的知识，我们有必要重温一下 Vue 中的一些基本概念。那么先上一张图，这张图从宏观上展现了 Vue 整体流程：</p>
<p><img src="http://upload-images.jianshu.io/upload_images/13429147-32832d6b08b108c4.jpg"></p>
<p>image</p>
<p>从上图中，不难发现一个 Vue 的应用程序是如何运行起来的，模板通过编译生成 AST，再由 AST 生成 Vue 的<code>render</code>函数（渲染函数），渲染函数结合数据生成 Virtual DOM 树，Diff 和 Patch 后生成新的 UI。从这张图中，可以接触到 Vue 的一些主要概念：</p>
<ul>
<li><strong>模板</strong>：Vue 的模板基于纯 HTML，基于 Vue 的模板语法，我们可以比较方便地声明数据和 UI 的关系。</li>
<li><strong>AST</strong>：AST 是 <strong>Abstract Syntax Tree</strong> 的简称，Vue 使用 HTML 的 Parser 将 HTML 模板解析为 AST，并且对 AST 进行一些优化的标记处理，提取最大的静态树，方便 Virtual DOM 时直接跳过 Diff。</li>
<li><strong>渲染函数</strong>：渲染函数是用来生成 Virtual DOM 的。Vue 推荐使用模板来构建我们的应用界面，在底层实现中 Vue 会将模板编译成渲染函数，当然我们也可以不写模板，直接写渲染函数，以获得更好的控制 （这部分是我们今天主要要了解和学习的部分）。</li>
<li><strong>Virtual DOM</strong>：虚拟 DOM 树，Vue 的 Virtual DOM Patching 算法是基于 <strong><a target="_blank" rel="noopener" href="https://github.com/snabbdom/snabbdom">Snabbdom</a></strong> 的实现，并在些基础上作了很多的调整和改进。</li>
<li><strong>Watcher</strong>：每个 Vue 组件都有一个对应的<code>watcher</code>，这个<code>watcher</code>将会在组件<code>render</code>的时候收集组件所依赖的数据，并在依赖有更新的时候，触发组件重新渲染。你根本不需要写<code>shouldComponentUpdate</code>，Vue 会自动优化并更新要更新的 UI。</li>
</ul>
<p>上图中，<code>render</code>函数可以作为一道分割线，<code>render</code>函数的左边可以称之为<strong>编译期</strong>，将 Vue 的模板转换为<strong>渲染函数</strong>。<code>render</code>函数的右边是 Vue 的运行时，主要是基于渲染函数生成 Virtual DOM 树，Diff 和 Patch。</p>
<h2 id="渲染函数的基础"><a href="#渲染函数的基础" class="headerlink" title="渲染函数的基础"></a>渲染函数的基础</h2><p>Vue 推荐在绝大多数情况下使用<code>template</code>来创建你的 HTML。然而在一些场景中，需要使用 JavaScript 的编程能力和创建 HTML，这就是**<code>render</code>函数**，它比<code>template</code>更接近编译器。</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">h1</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">a</span> &gt;</span></span><br><span class="line">        Hello world!</span><br><span class="line">    <span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>在 HTML 层，我们决定这样定义组件接口：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">anchored-heading</span> <span class="attr">:level</span>=<span class="string">&quot;1&quot;</span>&gt;</span>Hello world!<span class="tag">&lt;/<span class="name">anchored-heading</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>当我们开始写一个通过<code>level</code>的<code>prop</code>动态生成<code>heading</code>标签的组件，你可能很快想到这样实现：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">&lt;script type=<span class="string">&quot;text/x-template&quot;</span>&gt;</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">h1</span> <span class="attr">v-if</span>=<span class="string">&quot;level === 1&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">slot</span>&gt;</span><span class="tag">&lt;/<span class="name">slot</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span></span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">h2</span> <span class="attr">v-else-if</span>=<span class="string">&quot;level === 2&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">slot</span>&gt;</span><span class="tag">&lt;/<span class="name">slot</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">h2</span>&gt;</span></span></span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">h3</span> <span class="attr">v-else-if</span>=<span class="string">&quot;level === 3&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">slot</span>&gt;</span><span class="tag">&lt;/<span class="name">slot</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">h3</span>&gt;</span></span></span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">h4</span> <span class="attr">v-else-if</span>=<span class="string">&quot;level === 4&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">slot</span>&gt;</span><span class="tag">&lt;/<span class="name">slot</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">h4</span>&gt;</span></span></span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">h5</span> <span class="attr">v-else-if</span>=<span class="string">&quot;level === 5&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">slot</span>&gt;</span><span class="tag">&lt;/<span class="name">slot</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">h5</span>&gt;</span></span></span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">h6</span> <span class="attr">v-else-if</span>=<span class="string">&quot;level === 6&quot;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">        <span class="tag">&lt;<span class="name">slot</span>&gt;</span><span class="tag">&lt;/<span class="name">slot</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;/<span class="name">h6</span>&gt;</span></span></span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="title class_">Vue</span>.<span class="title function_">component</span>(<span class="string">&#x27;anchored-heading&#x27;</span>, &#123;</span><br><span class="line">    <span class="attr">template</span>: <span class="string">&#x27;#anchored-heading-template&#x27;</span>,</span><br><span class="line">    <span class="attr">props</span>: &#123;</span><br><span class="line">        <span class="attr">level</span>: &#123;</span><br><span class="line">            <span class="attr">type</span>: <span class="title class_">Number</span>,</span><br><span class="line">            <span class="attr">required</span>: <span class="literal">true</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<p>在这种场景中使用 <code>template</code> 并不是最好的选择：首先代码冗长，为了在不同级别的标题中插入锚点元素，我们需要重复地使用 <code>&lt;slot&gt;&lt;/slot&gt;</code>。</p>
<p>虽然模板在大多数组件中都非常好用，但是在这里它就不是很简洁的了。那么，我们来尝试使用 <code>render</code> 函数重写上面的例子：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="title class_">Vue</span>.<span class="title function_">component</span>(<span class="string">&#x27;anchored-heading&#x27;</span>, &#123;</span><br><span class="line">    <span class="attr">render</span>: <span class="keyword">function</span> (<span class="params">createElement</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="title function_">createElement</span>(</span><br><span class="line">            <span class="string">&#x27;h&#x27;</span> + <span class="variable language_">this</span>.<span class="property">level</span>,   </span><br><span class="line">            <span class="variable language_">this</span>.<span class="property">$slots</span>.<span class="property">default</span> </span><br><span class="line">        )</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">props</span>: &#123;</span><br><span class="line">        <span class="attr">level</span>: &#123;</span><br><span class="line">            <span class="attr">type</span>: <span class="title class_">Number</span>,</span><br><span class="line">            <span class="attr">required</span>: <span class="literal">true</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<p>简单清晰很多！简单来说，这样代码精简很多，但是需要非常熟悉 Vue 的实例属性。在这个例子中，你需要知道当你不使用 <code>slot</code> 属性向组件中传递内容时，比如 <code>anchored-heading</code> 中的 <code>Hello world!</code>，这些子元素被存储在组件实例中的 <code>$slots.default</code>中。</p>
<h2 id="节点、树以及虚拟-DOM"><a href="#节点、树以及虚拟-DOM" class="headerlink" title="节点、树以及虚拟 DOM"></a>节点、树以及虚拟 DOM</h2><p>对 Vue 的一些概念和渲染函数的基础有一定的了解之后，我们需要对一些浏览器的工作原理有一些了解，这样对我们学习<code>render</code>函数是很重要的。比如下面的这段 HTML 代码：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">h1</span>&gt;</span>My title<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line">    Some text content</span><br><span class="line">    </span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>当浏览器读到这些代码时，它会建立一个 **<a target="_blank" rel="noopener" href="https://javascript.info/dom-nodes">DOM 节点树</a>**来保持追踪，如果你会画一张家谱树来追踪家庭成员的发展一样。</p>
<p>HTML 的 DOM 节点树如下图所示：</p>
<p><img src="http://upload-images.jianshu.io/upload_images/13429147-53f54999b1bc18e9.png"></p>
<p>image</p>
<p>每个元素都是一个节点。每片文字也是一个节点。甚至注释也都是节点。一个节点就是页面的一个部分。就像家谱树一样，每个节点都可以有孩子节点 (也就是说每个部分可以包含其它的一些部分)。</p>
<p>高效的更新所有这些节点会是比较困难的，不过所幸你不必再手动完成这个工作了。你只需要告诉 Vue 你希望页面上的 HTML 是什么，这可以是在一个模板里：</p>
<p>或者一个渲染函数里：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">render</span>: <span class="keyword">function</span> (<span class="params">createElement</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="title function_">createElement</span>(<span class="string">&#x27;h1&#x27;</span>, <span class="variable language_">this</span>.<span class="property">blogTitle</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>在这两种情况下，Vue 都会自动保持页面的更新，即便 <code>blogTitle</code> 发生了改变。</p>
<h2 id="虚拟-DOM"><a href="#虚拟-DOM" class="headerlink" title="虚拟 DOM"></a>虚拟 DOM</h2><p>在 Vue 2.0 中，渲染层的实现做了根本性改动，那就是引入了虚拟 DOM。</p>
<p><img src="http://upload-images.jianshu.io/upload_images/13429147-4eb2a73597a2a9aa.png"></p>
<p>image</p>
<p>Vue 的编译器在编译模板之后，会把这些模板编译成一个渲染函数。而函数被调用的时候就会渲染并且返回一个<strong>虚拟 DOM 的树</strong>。</p>
<p>当我们有了这个虚拟的树之后，再交给一个 <strong>Patch 函数</strong>，负责把这些虚拟 DOM 真正施加到真实的 DOM 上。在这个过程中，Vue 有自身的响应式系统来侦测在渲染过程中所依赖到的数据来源。在渲染过程中，侦测到数据来源之后就可以精确感知数据源的变动。到时候就可以根据需要重新进行渲染。当重新进行渲染之后，会生成一个新的树，将新的树与旧的树进行对比，就可以最终得出应施加到真实 DOM 上的改动。最后再通过 Patch 函数施加改动。</p>
<p>简单点讲，在 Vue 的底层实现上，Vue 将模板编译成虚拟 DOM 渲染函数。结合 Vue 自带的响应系统，在应该状态改变时，Vue 能够智能地计算出重新渲染组件的最小代价并应到 DOM 操作上。</p>
<p><img src="http://upload-images.jianshu.io/upload_images/13429147-4c7f8bdf4b804bd9.png"></p>
<p>image</p>
<p>Vue 支持我们通过<code>data</code>参数传递一个 JavaScript 对象做为组件数据，然后 Vue 将遍历此对象属性，使用 <a target="_blank" rel="noopener" href="https://www.w3cplus.com/vue/vue-two-way-binding-object-defineproperty.html"><code>Object.defineProperty</code>方法</a>设置描述对象，通过存取器函数可以追踪该属性的变更，Vue 创建了一层<code>Watcher</code>层，在组件渲染的过程中把属性记录为依赖，之后当依赖项的<code>setter</code>被调用时，会通知<code>Watcher</code>重新计算，从而使它关联的组件得以更新, 如下图：</p>
<p><img src="http://upload-images.jianshu.io/upload_images/13429147-e5ab233db6c73c31.png"></p>
<p>image</p>
<p>有关于 Vue 的响应式相关的内容，可以阅读下列文章：</p>
<ul>
<li><a target="_blank" rel="noopener" href="https://www.w3cplus.com/vue/understanding-vue-js-reactivity-depth-object-defineproperty.html">深入理解 Vue.js 响应式原理</a></li>
<li><a target="_blank" rel="noopener" href="https://www.w3cplus.com/vue/vue-two-way-binding-object-defineproperty.html">Vue 双向绑定的实现原理<code>Object.defineproperty</code></a></li>
<li><a target="_blank" rel="noopener" href="https://www.w3cplus.com/vue/vue-two-way-binding.html">Vue 的双向绑定原理及实现</a></li>
<li><a target="_blank" rel="noopener" href="https://www.w3cplus.com/vue/vue-reactivity.html">Vue 中的响应式</a></li>
<li><a target="_blank" rel="noopener" href="https://www.w3cplus.com/vue/reactive.html">从 JavaScript 属性描述器剖析 Vue.js 响应式视图</a></li>
</ul>
<p>对于 Vue 自带的响应式系统，并不是咱们今天要聊的东西。我们还是回到 Vue 的虚拟 DOM 中来。对于虚拟 DOM，咱们来看一个简单的实例，就是下图所示的这个，详细的阐述了<code>模板 → 渲染函数 → 虚拟DOM树 → 真实DOM</code>的一个过程</p>
<p><img src="http://upload-images.jianshu.io/upload_images/13429147-54ee24bdb630fb55.png"></p>
<p>image</p>
<p>其实 Vue 中的虚拟 DOM 还是很复杂的，我也是一知半解，如果你想深入的了解，可以阅读 @JoeRay61 的《<a target="_blank" rel="noopener" href="https://segmentfault.com/a/1190000008291645">Vue 原理解析之 Virtual DOM</a>》一文。</p>
<p>通过前面的学习，我们初步了解到 Vue 通过建立一个<strong>虚拟 DOM</strong> 对真实 DOM 发生的变化保持追踪。比如下面这行代码：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">return</span> <span class="title function_">createElement</span>(<span class="string">&#x27;h1&#x27;</span>, <span class="variable language_">this</span>.<span class="property">blogTitle</span>)</span><br></pre></td></tr></table></figure>

<p><code>createElement</code> 到底会返回什么呢？其实不是一个实际的 DOM 元素。它更准确的名字可能是 <code>createNodeDescription</code>，因为它所包含的信息会告诉 Vue 页面上需要渲染什么样的节点，及其子节点。我们把这样的节点描述为 “虚拟节点 (Virtual Node)”，也常简写它为“VNode”。“虚拟 DOM” 是我们对由 Vue 组件树建立起来的整个 VNode 树的称呼。</p>
<p>Vue 组件树建立起来的整个 VNode 树是唯一的。这意味着，下面的**<code>render</code>函数是无效**的：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">render</span>: <span class="keyword">function</span> (<span class="params">createElement</span>) &#123;</span><br><span class="line">    <span class="keyword">var</span> myParagraphVNode = <span class="title function_">createElement</span>(<span class="string">&#x27;p&#x27;</span>, <span class="string">&#x27;hi&#x27;</span>)</span><br><span class="line">    <span class="keyword">return</span> <span class="title function_">createElement</span>(<span class="string">&#x27;div&#x27;</span>, [</span><br><span class="line">        </span><br><span class="line">        myParagraphVNode, myParagraphVNode</span><br><span class="line">    ])</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>如果你真的需要重复很多次的元素 &#x2F; 组件，你可以使用工厂函数来实现。例如，下面这个例子 <code>render</code> 函数完美有效地渲染了 <code>20</code> 个重复的段落：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">render</span>: <span class="keyword">function</span> (<span class="params">createElement</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="title function_">createElement</span>(<span class="string">&#x27;div&#x27;</span>,</span><br><span class="line">        <span class="title class_">Array</span>.<span class="title function_">apply</span>(<span class="literal">null</span>, &#123; <span class="attr">length</span>: <span class="number">20</span> &#125;).<span class="title function_">map</span>(<span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="title function_">createElement</span>(<span class="string">&#x27;p&#x27;</span>, <span class="string">&#x27;hi&#x27;</span>)</span><br><span class="line">        &#125;)</span><br><span class="line">    )</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="Vue-的渲染机制"><a href="#Vue-的渲染机制" class="headerlink" title="Vue 的渲染机制"></a>Vue 的渲染机制</h2><p><img src="http://upload-images.jianshu.io/upload_images/13429147-b34d3ed28b6eccb6.png"></p>
<p>image</p>
<p>上图展示的是独立构建时的一个渲染流程图。</p>
<p>继续使用上面用到的模板到真实 DOM 过程的一个图：</p>
<p><img src="http://upload-images.jianshu.io/upload_images/13429147-3466e87621454e79.png"></p>
<p>image</p>
<p>这里会涉及到 Vue 的另外两个概念：</p>
<ul>
<li><strong>独立构建</strong>：包含模板编译器，渲染过程<code>HTML字符串 → render函数 → VNode → 真实DOM节点</code></li>
<li><strong>运行时构建</strong>：不包含模板编译器，渲染过程<code>render函数 → VNode → 真实DOM节点</code></li>
</ul>
<p>运行时构建的包，会比独立构建少一个模板编译器。在<code>$mount</code>函数上也不同。而<code>$mount</code>方法又是整个渲染过程的起始点。用一张流程图来说明：</p>
<p><img src="http://upload-images.jianshu.io/upload_images/13429147-7f193c6cb2e36da0.png"></p>
<p>image</p>
<p>由此图可以看到，在渲染过程中，提供了三种渲染模式，自定义<code>render</code>函数、<code>template</code>、<code>el</code>均可以渲染页面，也就是对应我们使用 Vue 时，三种写法：</p>
<h3 id="自定义render函数"><a href="#自定义render函数" class="headerlink" title="自定义render函数"></a>自定义<code>render函数</code></h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="title class_">Vue</span>.<span class="title function_">component</span>(<span class="string">&#x27;anchored-heading&#x27;</span>, &#123;</span><br><span class="line">    <span class="attr">render</span>: <span class="keyword">function</span> (<span class="params">createElement</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> createElement (</span><br><span class="line">            <span class="string">&#x27;h&#x27;</span> + <span class="variable language_">this</span>.<span class="property">level</span>,   </span><br><span class="line">            <span class="variable language_">this</span>.<span class="property">$slots</span>.<span class="property">default</span> </span><br><span class="line">        )</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">props</span>: &#123;</span><br><span class="line">        <span class="attr">level</span>: &#123;</span><br><span class="line">            <span class="attr">type</span>: <span class="title class_">Number</span>,</span><br><span class="line">            <span class="attr">required</span>: <span class="literal">true</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<h3 id="template写法"><a href="#template写法" class="headerlink" title="template写法"></a><code>template</code>写法</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> app = <span class="keyword">new</span> <span class="title class_">Vue</span>(&#123;</span><br><span class="line">    <span class="attr">template</span>: <span class="string">`&lt;div&gt;&#123;&#123; msg &#125;&#125;&lt;/div&gt;`</span>,</span><br><span class="line">    data () &#123;</span><br><span class="line">        <span class="keyword">return</span> &#123;</span><br><span class="line">            <span class="attr">msg</span>: <span class="string">&#x27;&#x27;</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<h3 id="el写法"><a href="#el写法" class="headerlink" title="el写法"></a><code>el</code>写法</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> app = <span class="keyword">new</span> <span class="title class_">Vue</span>(&#123;</span><br><span class="line">    <span class="attr">el</span>: <span class="string">&#x27;#app&#x27;</span>,</span><br><span class="line">    data () &#123;</span><br><span class="line">        <span class="keyword">return</span> &#123;</span><br><span class="line">            <span class="attr">msg</span>: <span class="string">&#x27;Hello Vue!&#x27;</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<p>这三种渲染模式最终都是要得到<code>render</code>函数。只不过用户自定义的<code>render</code>函数省去了程序分析的过程，等同于处理过的<code>render</code>函数，而普通的<code>template</code>或者<code>el</code>只是字符串，需要解析成 AST，再将 AST 转化为<code>render</code>函数。</p>
<blockquote>
<p><strong>记住一点，无论哪种方法，都要得到<code>render</code>函数。</strong></p>
</blockquote>
<p>我们在使用过程中具体要使用哪种调用方式，要根据具体的需求来。</p>
<p>如果是比较简单的逻辑，使用<code>template</code>和<code>el</code>比较好，因为这两种都属于声明式渲染，对用户理解比较容易，但灵活性比较差，因为最终生成的<code>render</code>函数是由程序通过 AST 解析优化得到的; 而使用自定义<code>render</code>函数相当于人已经将逻辑翻译给程序，能够胜任复杂的逻辑，灵活性高，但对于用户的理解相对差点。</p>
<h2 id="理解createElement"><a href="#理解createElement" class="headerlink" title="理解createElement"></a>理解<code>createElement</code></h2><p>在使用<code>render</code>函数，其中还有另一个需要掌握的部分，那就是<code>createElement</code>。接下来我们需要熟悉的是如何在<code>createElement</code>函数中生成模板。那么我们分两个部分来对<code>createElement</code>进行理解。</p>
<h3 id="createElement参数"><a href="#createElement参数" class="headerlink" title="createElement参数"></a><code>createElement</code>参数</h3><p><code>createElement</code>可以是接受多个参数：</p>
<h4 id="第一个参数：-String-Object-Function"><a href="#第一个参数：-String-Object-Function" class="headerlink" title="第一个参数：{String | Object | Function}"></a>第一个参数：<code>&#123;String | Object | Function&#125;</code></h4><p>第一个参数对于<code>createElement</code>而言是一个必须的参数，这个参数可以是字符串<code>string</code>、是一个对象<code>object</code>，也可以是一个函数<code>function</code>。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">&lt;div&gt;</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">custom-element</span>&gt;</span><span class="tag">&lt;/<span class="name">custom-element</span>&gt;</span></span></span><br><span class="line">&lt;/div&gt;</span><br><span class="line"></span><br><span class="line"><span class="title class_">Vue</span>.<span class="title function_">component</span>(<span class="string">&#x27;custom-element&#x27;</span>, &#123;</span><br><span class="line">    <span class="attr">render</span>: <span class="keyword">function</span> (<span class="params">createElement</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="title function_">createElement</span>(<span class="string">&#x27;div&#x27;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> app = <span class="keyword">new</span> <span class="title class_">Vue</span>(&#123;</span><br><span class="line">    <span class="attr">el</span>: <span class="string">&#x27;#app&#x27;</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<p>上面的示例，给<code>createElement</code>传了一个<code>String</code>参数<code>&#39;div&#39;</code>，即传了一个 HTML 标签字符。最后会有一个<code>div</code>元素渲染出来：</p>
<p><img src="http://upload-images.jianshu.io/upload_images/13429147-eb35f142664bda0c.png"></p>
<p>image</p>
<p>接着把上例中的<code>String</code>换成一个<code>Object</code>，比如：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="title class_">Vue</span>.<span class="title function_">component</span>(<span class="string">&#x27;custom-element&#x27;</span>, &#123;</span><br><span class="line">    <span class="attr">render</span>: <span class="keyword">function</span> (<span class="params">createElement</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="title function_">createElement</span>(&#123;</span><br><span class="line">            <span class="attr">template</span>: <span class="string">`&lt;div&gt;Hello Vue!&lt;/div&gt;`</span></span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<p>上例传了一个<code>&#123;template: &#39;&lt;div&gt;Hello Vue!&lt;/div&gt;&#39;&#125;</code>对象。此时<code>custom-element</code>组件渲染出来的结果如下：</p>
<p><img src="http://upload-images.jianshu.io/upload_images/13429147-cafcbeeddcfda7e4.png"></p>
<p>image</p>
<p>除此之外，还可以传一个<code>Function</code>，比如：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="title class_">Vue</span>.<span class="title function_">component</span>(<span class="string">&#x27;custom-element&#x27;</span>, &#123;</span><br><span class="line">    <span class="attr">render</span>: <span class="keyword">function</span> (<span class="params">createElement</span>) &#123;</span><br><span class="line">        <span class="keyword">var</span> eleFun = <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> &#123;</span><br><span class="line">                <span class="attr">template</span>: <span class="string">`&lt;div&gt;Hello Vue!&lt;/div&gt;`</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="title function_">createElement</span>(<span class="title function_">eleFun</span>())</span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<p>最终得到的结果和上图是一样的。这里传了一个<code>eleFun()</code>函数给<code>createElement</code>，而这个函数返回的是一个对象。</p>
<h4 id="第二个参数-Object"><a href="#第二个参数-Object" class="headerlink" title="第二个参数:{Object}"></a>第二个参数:<code>&#123;Object&#125;</code></h4><p><code>createElement</code>是一个可选参数，这个参数是一个<code>Object</code>。来看一个小示例：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">&lt;div&gt;</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">custom-element</span>&gt;</span><span class="tag">&lt;/<span class="name">custom-element</span>&gt;</span></span></span><br><span class="line">&lt;/div&gt;</span><br><span class="line"></span><br><span class="line"><span class="title class_">Vue</span>.<span class="title function_">component</span>(<span class="string">&#x27;custom-element&#x27;</span>, &#123;</span><br><span class="line">    <span class="attr">render</span>: <span class="keyword">function</span> (<span class="params">createElement</span>) &#123;</span><br><span class="line">        <span class="keyword">var</span> self = <span class="variable language_">this</span></span><br><span class="line"></span><br><span class="line">        </span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> <span class="title function_">createElement</span>(<span class="string">&#x27;div&#x27;</span>, &#123;</span><br><span class="line">            <span class="string">&#x27;class&#x27;</span>: &#123;</span><br><span class="line">                <span class="attr">foo</span>: <span class="literal">true</span>,</span><br><span class="line">                <span class="attr">bar</span>: <span class="literal">false</span></span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="attr">style</span>: &#123;</span><br><span class="line">                <span class="attr">color</span>: <span class="string">&#x27;red&#x27;</span>,</span><br><span class="line">                <span class="attr">fontSize</span>: <span class="string">&#x27;14px&#x27;</span></span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="attr">attrs</span>: &#123;</span><br><span class="line">                <span class="attr">id</span>: <span class="string">&#x27;boo&#x27;</span></span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="attr">domProps</span>: &#123;</span><br><span class="line">                <span class="attr">innerHTML</span>: <span class="string">&#x27;Hello Vue!&#x27;</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> app = <span class="keyword">new</span> <span class="title class_">Vue</span>(&#123;</span><br><span class="line">    <span class="attr">el</span>: <span class="string">&#x27;#app&#x27;</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<p>最终生成的 DOM，将会带一些属性和内容的<code>div</code>元素，如下图所示：</p>
<p><img src="http://upload-images.jianshu.io/upload_images/13429147-bef18523b2d62e16.png"></p>
<p>image</p>
<h4 id="第三个参数：-String-Array"><a href="#第三个参数：-String-Array" class="headerlink" title="第三个参数：{String | Array}"></a>第三个参数：{String | Array}</h4><p><code>createElement</code>还有第三个参数，这个参数是可选的，可以给其传一个<code>String</code>或<code>Array</code>。比如下面这个小示例：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">&lt;div&gt;</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">custom-element</span>&gt;</span><span class="tag">&lt;/<span class="name">custom-element</span>&gt;</span></span></span><br><span class="line">&lt;/div&gt;</span><br><span class="line"></span><br><span class="line"><span class="title class_">Vue</span>.<span class="title function_">component</span>(<span class="string">&#x27;custom-element&#x27;</span>, &#123;</span><br><span class="line">    <span class="attr">render</span>: <span class="keyword">function</span> (<span class="params">createElement</span>) &#123;</span><br><span class="line">        <span class="keyword">var</span> self = <span class="variable language_">this</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="title function_">createElement</span>(</span><br><span class="line">            <span class="string">&#x27;div&#x27;</span>, </span><br><span class="line">            &#123;</span><br><span class="line">                <span class="attr">class</span>: &#123;</span><br><span class="line">                    <span class="attr">title</span>: <span class="literal">true</span></span><br><span class="line">                &#125;,</span><br><span class="line">                <span class="attr">style</span>: &#123;</span><br><span class="line">                    <span class="attr">border</span>: <span class="string">&#x27;1px solid&#x27;</span>,</span><br><span class="line">                    <span class="attr">padding</span>: <span class="string">&#x27;10px&#x27;</span></span><br><span class="line">                &#125;</span><br><span class="line">            &#125;, </span><br><span class="line">            [</span><br><span class="line">                <span class="title function_">createElement</span>(<span class="string">&#x27;h1&#x27;</span>, <span class="string">&#x27;Hello Vue!&#x27;</span>),</span><br><span class="line">                <span class="title function_">createElement</span>(<span class="string">&#x27;p&#x27;</span>, <span class="string">&#x27;开始学习Vue!&#x27;</span>)</span><br><span class="line">            ] </span><br><span class="line">        )</span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> app = <span class="keyword">new</span> <span class="title class_">Vue</span>(&#123;</span><br><span class="line">    <span class="attr">el</span>: <span class="string">&#x27;#app&#x27;</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<p>最终的效果如下：</p>
<p><img src="http://upload-images.jianshu.io/upload_images/13429147-1c69ce736a29a3c1.png"></p>
<p>image</p>
<p>其实从上面这几个小例来看，不难发现，以往我们使用<code>Vue.component()</code>创建组件的方式，都可以用<code>render</code>函数配合<code>createElement</code>来完成。你也会发现，使用<code>Vue.component()</code>和<code>render</code>各有所长，正如文章开头的一个示例代码，就不适合<code>Vue.component()</code>的<code>template</code>，而使用<code>render</code>更方便。</p>
<p>接下来看一个小示例，看看<code>template</code>和<code>render</code>方式怎么创建相同效果的一个组件:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">&lt;div&gt;</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">custom-element</span>&gt;</span><span class="tag">&lt;/<span class="name">custom-element</span>&gt;</span></span></span><br><span class="line">&lt;/div&gt;</span><br><span class="line"></span><br><span class="line"><span class="title class_">Vue</span>.<span class="title function_">component</span>(<span class="string">&#x27;custom-element&#x27;</span>, &#123;</span><br><span class="line">    <span class="attr">template</span>: <span class="string">`&lt;div :class=&quot;&#123;show: show&#125;&quot; @click=&quot;handleClick&quot;&gt;Hello Vue!&lt;/div&gt;`</span>,</span><br><span class="line">    data () &#123;</span><br><span class="line">        <span class="keyword">return</span> &#123;</span><br><span class="line">            <span class="attr">show</span>: <span class="literal">true</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">methods</span>: &#123;</span><br><span class="line">        <span class="attr">handleClick</span>: <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">            <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;Clicked!&#x27;</span>)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<p>上面<code>Vue.component()</code>中的代码换成<code>render</code>函数之后，可以这样写：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="title class_">Vue</span>.<span class="title function_">component</span>(<span class="string">&#x27;custom-element&#x27;</span>, &#123;</span><br><span class="line">    <span class="attr">render</span>: <span class="keyword">function</span> (<span class="params">createElement</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="title function_">createElement</span>(<span class="string">&#x27;div&#x27;</span>, &#123;</span><br><span class="line">            <span class="attr">class</span>: &#123;</span><br><span class="line">                <span class="attr">show</span>: <span class="variable language_">this</span>.<span class="property">show</span></span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="attr">attrs</span>: &#123;</span><br><span class="line">                <span class="attr">id</span>: <span class="string">&#x27;box&#x27;</span></span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="attr">on</span>: &#123;</span><br><span class="line">                <span class="attr">click</span>: <span class="variable language_">this</span>.<span class="property">handleClick</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;, <span class="string">&#x27;Hello Vue!&#x27;</span>)</span><br><span class="line">    &#125;,</span><br><span class="line">    data () &#123;</span><br><span class="line">        <span class="keyword">return</span> &#123;</span><br><span class="line">            <span class="attr">show</span>: <span class="literal">true</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">methods</span>: &#123;</span><br><span class="line">        <span class="attr">handleClick</span>: <span class="keyword">function</span> (<span class="params"></span>) &#123;</span><br><span class="line">            <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;Clicked!&#x27;</span>)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<p>最后声明一个 Vue 实例，并挂载到<code>id</code>为<code>#app</code>的一个元素上：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> app = <span class="keyword">new</span> <span class="title class_">Vue</span>(&#123;</span><br><span class="line">    <span class="attr">el</span>: <span class="string">&#x27;#app&#x27;</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<h3 id="createElement解析过程"><a href="#createElement解析过程" class="headerlink" title="createElement解析过程"></a><code>createElement</code>解析过程</h3><p>简单的来看一下<code>createElement</code>解析的过程，这部分需要对 JS 有一些功底。不然看起来有点蛋疼：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="variable constant_">SIMPLE_NORMALIZE</span> = <span class="number">1</span></span><br><span class="line"><span class="keyword">const</span> <span class="variable constant_">ALWAYS_NORMALIZE</span> = <span class="number">2</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">createElement</span> (context, tag, data, children, normalizationType, alwaysNormalize) &#123;</span><br><span class="line"></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span> (<span class="title class_">Array</span>.<span class="title function_">isArray</span>(data) || <span class="title function_">isPrimitive</span>(data)) &#123;</span><br><span class="line">        normalizationType = children</span><br><span class="line">        children = data</span><br><span class="line">        data = <span class="literal">undefined</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span> (alwaysNormalize) normalizationType = <span class="variable constant_">ALWAYS_NORMALIZE</span></span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> <span class="title function_">_createElement</span>(context, tag, data, children, normalizationType)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">function</span> <span class="title function_">_createElement</span> (context, tag, data, children, normalizationType) &#123;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">if</span> (data &amp;&amp; data.<span class="property">__ob__</span>) &#123;</span><br><span class="line">            process.<span class="property">env</span>.<span class="property">NODE_ENV</span> !== <span class="string">&#x27;production&#x27;</span> &amp;&amp; <span class="title function_">warn</span>(</span><br><span class="line">            <span class="string">`Avoid using observed data object as vnode data: <span class="subst">$&#123;<span class="built_in">JSON</span>.stringify(data)&#125;</span>\n`</span> +</span><br><span class="line">            <span class="string">&#x27;Always create fresh vnode data objects in each render!&#x27;</span>,</span><br><span class="line">            context</span><br><span class="line">            )</span><br><span class="line">            <span class="keyword">return</span> <span class="title function_">createEmptyVNode</span>()</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        </span><br><span class="line">        </span><br><span class="line">        </span><br><span class="line">        <span class="keyword">if</span> (!tag) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="title function_">createEmptyVNode</span>()</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        </span><br><span class="line">        <span class="keyword">if</span> (<span class="title class_">Array</span>.<span class="title function_">isArray</span>(children) &amp;&amp; <span class="keyword">typeof</span> children[<span class="number">0</span>] === <span class="string">&#x27;function&#x27;</span>) &#123;</span><br><span class="line">            data = data || &#123;&#125;</span><br><span class="line">            data.<span class="property">scopedSlots</span> = &#123; <span class="attr">default</span>: children[<span class="number">0</span>] &#125;</span><br><span class="line">            children.<span class="property">length</span> = <span class="number">0</span></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        </span><br><span class="line">        <span class="keyword">if</span> (normalizationType === <span class="variable constant_">ALWAYS_NORMALIZE</span>) &#123;</span><br><span class="line">            children = <span class="title function_">normalizeChildren</span>(children)</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (normalizationType === <span class="variable constant_">SIMPLE_NORMALIZE</span>) &#123;</span><br><span class="line">            children = <span class="title function_">simpleNormalizeChildren</span>(children)</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">let</span> vnode, ns</span><br><span class="line"></span><br><span class="line">        </span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">typeof</span> tag === <span class="string">&#x27;string&#x27;</span>) &#123;</span><br><span class="line">            <span class="keyword">let</span> <span class="title class_">Ctor</span></span><br><span class="line">            </span><br><span class="line">            ns = config.<span class="title function_">getTagNamespace</span>(tag)</span><br><span class="line"></span><br><span class="line">            </span><br><span class="line">            <span class="keyword">if</span> (config.<span class="title function_">isReservedTag</span>(tag)) &#123;</span><br><span class="line">                </span><br><span class="line">                vnode = <span class="keyword">new</span> <span class="title class_">VNode</span>(</span><br><span class="line">                    config.<span class="title function_">parsePlatformTagName</span>(tag), data, children,</span><br><span class="line">                    <span class="literal">undefined</span>, <span class="literal">undefined</span>, context</span><br><span class="line">                )</span><br><span class="line"></span><br><span class="line">                </span><br><span class="line">            &#125; <span class="keyword">else</span> <span class="keyword">if</span> ((<span class="title class_">Ctor</span> = <span class="title function_">resolveAsset</span>(context.<span class="property">$options</span>, <span class="string">&#x27;components&#x27;</span>, tag))) &#123;</span><br><span class="line">                </span><br><span class="line">                vnode = <span class="title function_">createComponent</span>(<span class="title class_">Ctor</span>, data, context, children, tag)</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                </span><br><span class="line">                vnode = <span class="keyword">new</span> <span class="title class_">VNode</span>(</span><br><span class="line">                    tag, data, children,</span><br><span class="line">                    <span class="literal">undefined</span>, <span class="literal">undefined</span>, context</span><br><span class="line">                )</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">        </span><br><span class="line">        </span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            vnode = <span class="title function_">createComponent</span>(tag, data, context, children)</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        </span><br><span class="line">        <span class="keyword">if</span> (vnode) &#123;</span><br><span class="line">            </span><br><span class="line">            <span class="keyword">if</span> (ns) <span class="title function_">applyNS</span>(vnode, ns)</span><br><span class="line">            <span class="keyword">return</span> vnode</span><br><span class="line">        </span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="title function_">createEmptyVNode</span>()</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>简单的梳理了一个流程图，可以参考下</p>
<p><img src="http://upload-images.jianshu.io/upload_images/13429147-e0558045f83150dd.png"></p>
<p>image</p>
<blockquote>
<p>这部分代码和流程图来自于 @JoeRay61 的《<a target="_blank" rel="noopener" href="https://segmentfault.com/a/1190000008291645">Vue 原理解析之 Virtual DOM</a>》一文。</p>
</blockquote>
<h2 id="使用-JavaScript-代替模板功能"><a href="#使用-JavaScript-代替模板功能" class="headerlink" title="使用 JavaScript 代替模板功能"></a>使用 JavaScript 代替模板功能</h2><p>在使用 Vue 模板的时候，我们可以在模板中灵活的使用 <a target="_blank" rel="noopener" href="https://www.w3cplus.com/vue/v-if-vs-v-show.html"><code>v-if</code></a>、<a target="_blank" rel="noopener" href="https://www.w3cplus.com/vue/v-for.html"><code>v-for</code></a>、<a target="_blank" rel="noopener" href="https://www.w3cplus.com/vue/v-model.html"><code>v-model</code></a>和 <a target="_blank" rel="noopener" href="https://www.w3cplus.com/vue/vue-slot.html"><code>&lt;slot&gt;</code></a>之类的。但在<code>render</code>函数中是没有提供专用的 API。如果在<code>render</code>使用这些，需要使用原生的 JavaScript 来实现。</p>
<h3 id="v-if和v-for"><a href="#v-if和v-for" class="headerlink" title="v-if和v-for"></a><code>v-if</code>和<code>v-for</code></h3><p>在<code>render</code>函数中可以使用<code>if/else</code>和<code>map</code>来实现<code>template</code>中的<code>v-if</code>和<code>v-for</code>。</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">ul</span> <span class="attr">v-if</span>=<span class="string">&quot;items.length&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">li</span> <span class="attr">v-for</span>=<span class="string">&quot;item in items&quot;</span>&gt;</span>&#123;&#123; item &#125;&#125;<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">p</span> <span class="attr">v-else</span>&gt;</span>No items found.<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>换成<code>render</code>函数，可以这样写：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="title class_">Vue</span>.<span class="title function_">component</span>(<span class="string">&#x27;item-list&#x27;</span>,&#123;</span><br><span class="line">    <span class="attr">props</span>: [<span class="string">&#x27;items&#x27;</span>],</span><br><span class="line">    <span class="attr">render</span>: <span class="keyword">function</span> (<span class="params">createElement</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="property">items</span>.<span class="property">length</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="title function_">createElement</span>(<span class="string">&#x27;ul&#x27;</span>, <span class="variable language_">this</span>.<span class="property">items</span>.<span class="title function_">map</span>(<span class="function">(<span class="params">item</span>) =&gt;</span> &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="title function_">createElement</span>(<span class="string">&#x27;item&#x27;</span>)</span><br><span class="line">            &#125;))</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="title function_">createElement</span>(<span class="string">&#x27;p&#x27;</span>, <span class="string">&#x27;No items found.&#x27;</span>)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">&lt;div&gt;</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">item-list</span> <span class="attr">:items</span>=<span class="string">&quot;items&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">item-list</span>&gt;</span></span></span><br><span class="line">&lt;/div&gt;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> app = <span class="keyword">new</span> <span class="title class_">Vue</span>(&#123;</span><br><span class="line">    <span class="attr">el</span>: <span class="string">&#x27;#app&#x27;</span>,</span><br><span class="line">    data () &#123;</span><br><span class="line">        <span class="keyword">return</span> &#123;</span><br><span class="line">            <span class="attr">items</span>: [<span class="string">&#x27;大漠&#x27;</span>, <span class="string">&#x27;W3cplus&#x27;</span>, <span class="string">&#x27;blog&#x27;</span>]</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<p>得到的效果如下：</p>
<p><img src="http://upload-images.jianshu.io/upload_images/13429147-b4d9489c6fd49ab6.gif"></p>
<p>image</p>
<h3 id="v-model"><a href="#v-model" class="headerlink" title="v-model"></a><code>v-model</code></h3><p><code>render</code>函数中也没有与<code>v-model</code>相应的 API，如果要实现<code>v-model</code>类似的功能，同样需要使用原生 JavaScript 来实现。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">&lt;div&gt;</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">el-input</span> <span class="attr">:</span> @<span class="attr">input</span>=<span class="string">&quot;val =&gt; name = val&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">el-input</span>&gt;</span></span></span><br><span class="line">&lt;/div&gt;</span><br><span class="line"></span><br><span class="line"><span class="title class_">Vue</span>.<span class="title function_">component</span>(<span class="string">&#x27;el-input&#x27;</span>, &#123;</span><br><span class="line">    <span class="attr">render</span>: <span class="keyword">function</span> (<span class="params">createElement</span>) &#123;</span><br><span class="line">        <span class="keyword">var</span> self = <span class="variable language_">this</span></span><br><span class="line">        <span class="keyword">return</span> <span class="title function_">createElement</span>(<span class="string">&#x27;input&#x27;</span>, &#123;</span><br><span class="line">            <span class="attr">domProps</span>: &#123;</span><br><span class="line">                <span class="attr">value</span>: self.<span class="property">name</span></span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="attr">on</span>: &#123;</span><br><span class="line">                <span class="attr">input</span>: <span class="keyword">function</span> (<span class="params">event</span>) &#123;</span><br><span class="line">                    self.$emit(<span class="string">&#x27;input&#x27;</span>, event.<span class="property">target</span>.<span class="property">value</span>)</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">props</span>: &#123;</span><br><span class="line">        <span class="attr">name</span>: <span class="title class_">String</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> app = <span class="keyword">new</span> <span class="title class_">Vue</span>(&#123;</span><br><span class="line">    <span class="attr">el</span>: <span class="string">&#x27;#app&#x27;</span>,</span><br><span class="line">    data () &#123;</span><br><span class="line">        <span class="keyword">return</span> &#123;</span><br><span class="line">            <span class="attr">name</span>: <span class="string">&#x27;大漠&#x27;</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<p>刷新你的浏览器，可以看到效果如下：</p>
<p><img src="http://upload-images.jianshu.io/upload_images/13429147-a59263e3580b34ee.png"></p>
<p>image</p>
<p>这就是深入底层要付出的，尽管麻烦了一些，但相对于 <code>v-model</code> 来说，你可以更灵活地控制。</p>
<h3 id="插槽"><a href="#插槽" class="headerlink" title="插槽"></a>插槽</h3><p>你可以从<code>this.$slots</code>获取 VNodes 列表中的静态内容：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">render</span>: <span class="keyword">function</span> (<span class="params">createElement</span>) &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> <span class="title function_">createElement</span>(<span class="string">&#x27;div&#x27;</span>, <span class="variable language_">this</span>.<span class="property">$slots</span>.<span class="property">default</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>还可以从<code>this.$scopedSlots</code>中获得能用作函数的作用域插槽，这个函数返回 VNodes:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">props</span>: [<span class="string">&#x27;message&#x27;</span>],</span><br><span class="line"><span class="attr">render</span>: <span class="keyword">function</span> (<span class="params">createElement</span>) &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> <span class="title function_">createElement</span>(<span class="string">&#x27;div&#x27;</span>, [</span><br><span class="line">        <span class="variable language_">this</span>.<span class="property">$scopedSlots</span>.<span class="title function_">default</span>(&#123;</span><br><span class="line">            <span class="attr">text</span>: <span class="variable language_">this</span>.<span class="property">message</span></span><br><span class="line">        &#125;)</span><br><span class="line">    ])</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>如果要用渲染函数向子组件中传递作用域插槽，可以利用 VNode 数据中的<code>scopedSlots</code>域：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">&lt;div&gt;</span><br><span class="line">    <span class="language-xml"><span class="tag">&lt;<span class="name">custom-ele</span>&gt;</span><span class="tag">&lt;/<span class="name">custom-ele</span>&gt;</span></span></span><br><span class="line">&lt;/div&gt;</span><br><span class="line"></span><br><span class="line"><span class="title class_">Vue</span>.<span class="title function_">component</span>(<span class="string">&#x27;custom-ele&#x27;</span>, &#123;</span><br><span class="line">    <span class="attr">render</span>: <span class="keyword">function</span> (<span class="params">createElement</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="title function_">createElement</span>(<span class="string">&#x27;div&#x27;</span>, [</span><br><span class="line">            <span class="title function_">createElement</span>(<span class="string">&#x27;child&#x27;</span>, &#123;</span><br><span class="line">                <span class="attr">scopedSlots</span>: &#123;</span><br><span class="line">                    <span class="attr">default</span>: <span class="keyword">function</span> (<span class="params">props</span>) &#123;</span><br><span class="line">                        <span class="keyword">return</span> [</span><br><span class="line">                            <span class="title function_">createElement</span>(<span class="string">&#x27;span&#x27;</span>, <span class="string">&#x27;From Parent Component&#x27;</span>),</span><br><span class="line">                            <span class="title function_">createElement</span>(<span class="string">&#x27;span&#x27;</span>, props.<span class="property">text</span>)</span><br><span class="line">                        ]</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;)</span><br><span class="line">        ])</span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="title class_">Vue</span>.<span class="title function_">component</span>(<span class="string">&#x27;child&#x27;</span>, &#123;</span><br><span class="line">    <span class="attr">render</span>: <span class="keyword">function</span> (<span class="params">createElement</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="title function_">createElement</span>(<span class="string">&#x27;strong&#x27;</span>, <span class="variable language_">this</span>.<span class="property">$scopedSlots</span>.<span class="title function_">default</span>(&#123;</span><br><span class="line">            <span class="attr">text</span>: <span class="string">&#x27;This is Child Component&#x27;</span></span><br><span class="line">        &#125;))</span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> app = <span class="keyword">new</span> <span class="title class_">Vue</span>(&#123;</span><br><span class="line">    <span class="attr">el</span>: <span class="string">&#x27;#app&#x27;</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<h2 id="JSX"><a href="#JSX" class="headerlink" title="JSX"></a>JSX</h2><p>如果写习惯了<code>template</code>，然后要用<code>render</code>函数来写，一定会感觉好痛苦，特别是面对复杂的组件的时候。不过我们在 Vue 中使用 JSX 可以让我们回到更接近于模板的语法上。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="title class_">AnchoredHeading</span> <span class="keyword">from</span> <span class="string">&#x27;./AnchoredHeading.vue&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">new</span> <span class="title class_">Vue</span>(&#123;</span><br><span class="line">    <span class="attr">el</span>: <span class="string">&#x27;#demo&#x27;</span>,</span><br><span class="line">    <span class="attr">render</span>: <span class="keyword">function</span> (<span class="params">h</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> (</span><br><span class="line">            <span class="language-xml"><span class="tag">&lt;<span class="name">AnchoredHeading</span> <span class="attr">level</span>=<span class="string">&#123;1&#125;</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                <span class="tag">&lt;<span class="name">span</span>&gt;</span>Hello<span class="tag">&lt;/<span class="name">span</span>&gt;</span> world!</span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;/<span class="name">AnchoredHeading</span>&gt;</span></span></span><br><span class="line">        )</span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<blockquote>
<p>将 <code>h</code> 作为 <code>createElement</code> 的别名是 Vue 生态系统中的一个通用惯例，实际上也是 JSX 所要求的，如果在作用域中 <code>h</code> 失去作用，在应用中会触发报错。</p>
</blockquote>
<h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>回过头来看，Vue 中的渲染核心关键的几步流程还是非常清晰的：</p>
<ul>
<li><code>new Vue</code>，执行初始化</li>
<li>挂载<code>$mount</code>方法，通过自定义<code>render</code>方法、<code>template</code>、<code>el</code>等生成<code>render</code>函数</li>
<li>通过<code>Watcher</code>监听数据的变化</li>
<li>当数据发生变化时，<code>render</code>函数执行生成 VNode 对象</li>
<li>通过<code>patch</code>方法，对比新旧 VNode 对象，通过 DOM Diff 算法，添加、修改、删除真正的 DOM 元素</li>
</ul>
<p>至此，整个<code>new Vue</code>的渲染过程完毕。</p>
<p>而这篇文章，主要把精力集中在<code>render</code>函数这一部分。学习了怎么用<code>render</code>函数来创建组件，以及了解了其中<code>createElement</code>。</p>
<p>最后要说的是，上文虽然以学习<code>render</code>函数，但文中涉及了 Vue 不少的知识点，也有点零乱。初学者自己根据自己获取所要的知识点。由于本人也是初涉 Vue 相关的知识点，如果文章中有不对之处，烦请路过的大神拍正。</p>
<p>原文地址 <a target="_blank" rel="noopener" href="https://www.jianshu.com/p/7508d2a114d3">www.jianshu.com</a></p>

    </div>
     
    <div class="post-footer__meta"><p>updated at 2022-06-22</p></div> 
    <div class="post-entry__tags"><a href="/tags/Vue/" class="post-tags__link button"># Vue</a></div> 
</article>


    <div class="nav">
        <div class="nav__prev">
            
                <a href="/2020/07/20/vue%E5%85%84%E5%BC%9F%E7%BB%84%E4%BB%B6%E9%97%B4%E4%BC%A0%E6%95%B0%E6%8D%AE%E7%9A%84%E6%96%B9%E6%B3%95-%E4%BA%8B%E4%BB%B6/" class="nav__link">
                    <div>
                        <svg viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" width="24" height="24"><path d="M589.088 790.624L310.464 512l278.624-278.624 45.248 45.248L400.96 512l233.376 233.376z" fill="#808080"></path></svg>
                    </div>
                    <div>
                        <div class="nav__label">
                            Previous Post
                        </div>
                        <div class="nav__title">
                            vue兄弟组件间传数据的方法-事件
                        </div>
                    </div>
                </a>
            
        </div>
        <div class="nav__next">
            
                <a href="/2020/07/01/element%E6%BA%90%E7%A0%81%E8%A7%A3%E6%9E%90%E4%B9%8Bcheckbox/" class="nav__link">
                    <div>
                        <div class="nav__label">
                            Next Post
                        </div>
                        <div class="nav__title">
                            element源码解析之checkbox
                        </div>
                    </div>
                    <div>
                        <svg viewBox="0 0 1024 1024" xmlns="http://www.w3.org/2000/svg" width="24" height="24"><path d="M434.944 790.624l-45.248-45.248L623.04 512l-233.376-233.376 45.248-45.248L713.568 512z" fill="#808080"></path></svg>
                    </div>
                </a>
            
        </div>
    </div>





</main>

            <footer class="footer">
    
    


    
     
 

 
    
        
        <p class="footer-copyright">
            Copyright © 2022 <a href="/">SleeoWen-Blog</a>
        </p>
    
    
    <p>Powered by <a href="https://hexo.io" target="_blank">Hexo</a> | Theme - <a href="https://github.com/ChrAlpha/hexo-theme-cards" target="_blank">Cards</a></p>
</footer>

        </div>
         

 

 

 

 



 



 


    
 

 

 

 

 

 




    </body>
</html>
